{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"Dino Service for distributed notifications using MQTT over websockets or TCP streams. User sends a message in a one-to-one/group chat, Backend checks business logic and rules, then calls Dino Server REST API to save and broadcast a new message, Dino Server saves the message in Cassandra, Dino Server sends a broadcast event to the relevant MQTT topics (every user has their own topic), Clients subscribing to their topics receives the event.","title":"Home"},{"location":"#dino","text":"Service for distributed notifications using MQTT over websockets or TCP streams. User sends a message in a one-to-one/group chat, Backend checks business logic and rules, then calls Dino Server REST API to save and broadcast a new message, Dino Server saves the message in Cassandra, Dino Server sends a broadcast event to the relevant MQTT topics (every user has their own topic), Clients subscribing to their topics receives the event.","title":"Dino"},{"location":"md/events/","text":"MQTT Events Dino is using VerneMQ to broadcast events to clients using MQTT version 5. Below are the possible events a client can receive, and when they are received. For events, it doesn't matter if they're for a 1-to-1 conversation in a multi-user group, they look the same, but group_type will be different (if specified). Possible values for fields group_type 0 : multi-user group, 1 : 1-to-1. message_type 0 : message, 1 : no thanks, 2 : no thanks (hide), 3 : image, 4 : greeter meeter auto, 5 : greeter meeter manual, 100 : action. event_type join leave group read edit attachment message action_log delete_attachment delete_message A group you're part of has been created or updated Event schema not yet finalized. { \"event_type\": \"group\", \"group_id\": \"9d78163c-1144-485a-92c6-6015afc6cd40\", \"name\": \"a name\", \"created_at\": 1597877421.453804, \"updated_at\": 1597877421.453804, \"last_message_time\": 1597877421.453804, \"group_type\": 0, \"owner_id\": 1234, \"user_ids\": [1234] } New message in a group you're part of Event schema not yet finalized. { \"event_type\": \"message\", \"group_id\": \"6cbb3265-2a7f-494d-92ad-f4503d55d49f\", \"sender_id\": 1234, \"file_id\": null, \"message_id\": \"c87efd18-8879-4c24-8b26-ccb7f40a0fe5\", \"message_payload\": \"<some content>\", \"message_type\": 0, \"created_at\": 1597877384.794828 } New attachment in a group you're part of Event schema not yet finalized. { \"event_type\": \"attachment\", \"group_id\": \"6cbb3265-2a7f-494d-92ad-f4503d55d49f\", \"sender_id\": 1234, \"file_id\": \"f4503d55d49ff4503d55d49f\", \"message_id\": \"c87efd18-8879-4c24-8b26-ccb7f40a0fe5\", \"message_payload\": \"<some content>\", \"message_type\": 3, \"created_at\": 1597877384.794828 } A message was edited Event schema not yet finalized. { \"event_type\": \"edit\", \"group_id\": \"6cbb3265-2a7f-494d-92ad-f4503d55d49f\", \"sender_id\": 1234, \"file_id\": \"f4503d55d49ff4503d55d49f\", \"message_id\": \"c87efd18-8879-4c24-8b26-ccb7f40a0fe5\", \"message_payload\": \"<some content>\", \"message_type\": 0, \"created_at\": 1597877384.794828 } An action log was created Action logs can be joins, leaves, highlight updated, group pinned etc. Event schema not yet finalized. { \"event_type\": \"action_log\", \"group_id\": \"6cbb3265-2a7f-494d-92ad-f4503d55d49f\", \"sender_id\": 1234, \"file_id\": \"f4503d55d49ff4503d55d49f\", \"message_id\": \"c87efd18-8879-4c24-8b26-ccb7f40a0fe5\", \"message_payload\": \"<some content>\", \"message_type\": 100, \"created_at\": 1597877384.794828 } A user read a message/conversation Read receipts are only broadcasted in 1-to-1 conversations, not in multi-user groups. Event schema not yet finalized. { \"event_type\": \"read\", \"group_id\": \"6cbb3265-2a7f-494d-92ad-f4503d55d49f\", \"user_id\": 1234, \"read_at\": 1597877384.794828, } Attachment(s) deleted There may be multiple attachments connected to a single message, so message_ids and file_ids are lists. { \"event_type\": \"delete_attachment\", \"created_at\": 1597877384.794828, \"group_id\": \"6cbb3265-2a7f-494d-92ad-f4503d55d49f\", \"message_ids\": [ \"eeb0b18f-5485-4a24-8bd4-159301e4b554\", \"44b393c1-8ae2-4832-9770-07a043543423\" ], \"file_ids\": [ \"238FD179EC794EFFBC033F491C335838\", \"95B1A97EDC6F4F5596D0158C55D17B1E\" ] }","title":"Events"},{"location":"md/events/#mqtt-events","text":"Dino is using VerneMQ to broadcast events to clients using MQTT version 5. Below are the possible events a client can receive, and when they are received. For events, it doesn't matter if they're for a 1-to-1 conversation in a multi-user group, they look the same, but group_type will be different (if specified).","title":"MQTT Events"},{"location":"md/events/#possible-values-for-fields","text":"","title":"Possible values for fields"},{"location":"md/events/#group_type","text":"0 : multi-user group, 1 : 1-to-1.","title":"group_type"},{"location":"md/events/#message_type","text":"0 : message, 1 : no thanks, 2 : no thanks (hide), 3 : image, 4 : greeter meeter auto, 5 : greeter meeter manual, 100 : action.","title":"message_type"},{"location":"md/events/#event_type","text":"join leave group read edit attachment message action_log delete_attachment delete_message","title":"event_type"},{"location":"md/events/#a-group-youre-part-of-has-been-created-or-updated","text":"Event schema not yet finalized. { \"event_type\": \"group\", \"group_id\": \"9d78163c-1144-485a-92c6-6015afc6cd40\", \"name\": \"a name\", \"created_at\": 1597877421.453804, \"updated_at\": 1597877421.453804, \"last_message_time\": 1597877421.453804, \"group_type\": 0, \"owner_id\": 1234, \"user_ids\": [1234] }","title":"A group you're part of has been created or updated"},{"location":"md/events/#new-message-in-a-group-youre-part-of","text":"Event schema not yet finalized. { \"event_type\": \"message\", \"group_id\": \"6cbb3265-2a7f-494d-92ad-f4503d55d49f\", \"sender_id\": 1234, \"file_id\": null, \"message_id\": \"c87efd18-8879-4c24-8b26-ccb7f40a0fe5\", \"message_payload\": \"<some content>\", \"message_type\": 0, \"created_at\": 1597877384.794828 }","title":"New message in a group you're part of"},{"location":"md/events/#new-attachment-in-a-group-youre-part-of","text":"Event schema not yet finalized. { \"event_type\": \"attachment\", \"group_id\": \"6cbb3265-2a7f-494d-92ad-f4503d55d49f\", \"sender_id\": 1234, \"file_id\": \"f4503d55d49ff4503d55d49f\", \"message_id\": \"c87efd18-8879-4c24-8b26-ccb7f40a0fe5\", \"message_payload\": \"<some content>\", \"message_type\": 3, \"created_at\": 1597877384.794828 }","title":"New attachment in a group you're part of"},{"location":"md/events/#a-message-was-edited","text":"Event schema not yet finalized. { \"event_type\": \"edit\", \"group_id\": \"6cbb3265-2a7f-494d-92ad-f4503d55d49f\", \"sender_id\": 1234, \"file_id\": \"f4503d55d49ff4503d55d49f\", \"message_id\": \"c87efd18-8879-4c24-8b26-ccb7f40a0fe5\", \"message_payload\": \"<some content>\", \"message_type\": 0, \"created_at\": 1597877384.794828 }","title":"A message was edited"},{"location":"md/events/#an-action-log-was-created","text":"Action logs can be joins, leaves, highlight updated, group pinned etc. Event schema not yet finalized. { \"event_type\": \"action_log\", \"group_id\": \"6cbb3265-2a7f-494d-92ad-f4503d55d49f\", \"sender_id\": 1234, \"file_id\": \"f4503d55d49ff4503d55d49f\", \"message_id\": \"c87efd18-8879-4c24-8b26-ccb7f40a0fe5\", \"message_payload\": \"<some content>\", \"message_type\": 100, \"created_at\": 1597877384.794828 }","title":"An action log was created"},{"location":"md/events/#a-user-read-a-messageconversation","text":"Read receipts are only broadcasted in 1-to-1 conversations, not in multi-user groups. Event schema not yet finalized. { \"event_type\": \"read\", \"group_id\": \"6cbb3265-2a7f-494d-92ad-f4503d55d49f\", \"user_id\": 1234, \"read_at\": 1597877384.794828, }","title":"A user read a message/conversation"},{"location":"md/events/#attachments-deleted","text":"There may be multiple attachments connected to a single message, so message_ids and file_ids are lists. { \"event_type\": \"delete_attachment\", \"created_at\": 1597877384.794828, \"group_id\": \"6cbb3265-2a7f-494d-92ad-f4503d55d49f\", \"message_ids\": [ \"eeb0b18f-5485-4a24-8bd4-159301e4b554\", \"44b393c1-8ae2-4832-9770-07a043543423\" ], \"file_ids\": [ \"238FD179EC794EFFBC033F491C335838\", \"95B1A97EDC6F4F5596D0158C55D17B1E\" ] }","title":"Attachment(s) deleted"},{"location":"md/rest_api/","text":"REST API For documentation about the rest api, see the OpenAPI specification where it's deployed: http://host:9800/docs#/","title":"REST API"},{"location":"md/rest_api/#rest-api","text":"For documentation about the rest api, see the OpenAPI specification where it's deployed: http://host:9800/docs#/","title":"REST API"},{"location":"md/usage/","text":"Client usage Dino is using MQTT version 5. First connect to MQTT and subscribe to your User ID topic. ACLs on the MQTT server side is set to read-only on the user's own \"user ID topic\" only; trying to subscribe on another user ID topic than the \"username\" a client successfully authenticated with will result in an error: const settings = { clientId: '1234', username: '1234', password: '<when hashed, must match stored value in redis that the mqtt server will check against>', clean: false, qos: 1 } const client = mqtt.connect('mqtt://host:port/mqtt', settings); client.on('connect', function () { client.subscribe('1234', {qos: 1}, function (err) { if (err) { console.log(err); } }) }); client.on('message', function (topic, message) { console.log(message.toString()); });","title":"Usage"},{"location":"md/usage/#client-usage","text":"Dino is using MQTT version 5. First connect to MQTT and subscribe to your User ID topic. ACLs on the MQTT server side is set to read-only on the user's own \"user ID topic\" only; trying to subscribe on another user ID topic than the \"username\" a client successfully authenticated with will result in an error: const settings = { clientId: '1234', username: '1234', password: '<when hashed, must match stored value in redis that the mqtt server will check against>', clean: false, qos: 1 } const client = mqtt.connect('mqtt://host:port/mqtt', settings); client.on('connect', function () { client.subscribe('1234', {qos: 1}, function (err) { if (err) { console.log(err); } }) }); client.on('message', function (topic, message) { console.log(message.toString()); });","title":"Client usage"}]}